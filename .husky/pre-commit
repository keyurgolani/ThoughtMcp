echo "ğŸ” Running pre-commit validations..."

# Check for sensitive files first (exclude .env.example which is a template)
echo "ï¿½ CChecking for sensitive files..."
if git diff --cached --name-only | grep -E "\.(key|pem|p12|pfx)$|\.env$|\.env\.(local|development|test|production)$" > /dev/null; then
  echo "âŒ Attempting to commit sensitive files. Please remove them from the commit."
  git diff --cached --name-only | grep -E "\.(key|pem|p12|pfx)$|\.env$|\.env\.(local|development|test|production)$"
  exit 1
fi

# Run full build with all quality gates
echo "ğŸ—ï¸  Running full build with quality gates..."
timeout 220s npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Please fix the issues above."
  echo "ğŸ’¡ The build includes: format check, security audit, lint, typecheck, tests with coverage, and production build."
  exit 1
fi

echo "âœ… Pre-commit validations passed!"
