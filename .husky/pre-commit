echo "ğŸ” Running pre-commit validations..."

# Check for sensitive files first (exclude .env.example which is a template)
echo "ğŸ” Checking for sensitive files..."
if git diff --cached --name-only | grep -E "\.(key|pem|p12|pfx)$|\.env$|\.env\.(local|development|test|production)$" > /dev/null; then
  echo "âŒ Attempting to commit sensitive files. Please remove them from the commit."
  git diff --cached --name-only | grep -E "\.(key|pem|p12|pfx)$|\.env$|\.env\.(local|development|test|production)$"
  exit 1
fi

# Run CI validation (same as CI: audit, format:check, lint:strict, typecheck, test:coverage)
echo "ğŸ—ï¸  Running CI validation..."
timeout 220s npm run validate:ci
if [ $? -ne 0 ]; then
  echo "âŒ CI validation failed. Please fix the issues above."
  echo "ğŸ’¡ CI validation includes: security audit, format check, strict lint (zero warnings), typecheck, tests with coverage."
  exit 1
fi

echo "âœ… Pre-commit validations passed!"
