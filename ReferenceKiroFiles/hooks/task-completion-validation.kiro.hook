{
  "enabled": true,
  "name": "Task Completion",
  "description": "When a task is marked completed, perform comprehensive workspace validation including steering document compliance, documentation updates, file organization, temporary file cleanup, validation checks, and user-level product validation via MCP server",
  "version": "1",
  "when": {
    "type": "fileEdited",
    "patterns": [
      ".kiro/specs/**/tasks.md"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "A task has been marked as completed. Perform a comprehensive workspace validation:\n\n1. **Steering Document Compliance**: Compare the entire workspace against ComprehensiveDevelopmentGuide.md meticulously. Check:\n   - All files follow TDD principles with tests present\n   - No technical debt (no `any` types, no suppression comments, no alternative file versions)\n   - Test coverage meets 95%+ line, 90%+ branch requirements\n   - All tests passing (run `timeout 120s npm test`)\n   - File organization follows prescribed structure\n   - Development files properly organized in `development/` subdirectories\n   - No forbidden patterns or anti-patterns present\n\n2. **Documentation Updates**: Verify project documentation is current:\n   - Check `docs/` for outdated information\n   - Verify README.md reflects current state\n   - Ensure spec task completion summaries exist in `development/summaries/`\n   - Confirm all architectural decisions documented\n\n3. **File Organization**: Validate workspace structure:\n   - No temporary files outside `development/` directory\n   - No alternative file versions (-v2, -new, -old, -temp, -backup, -enhanced, -improved)\n   - Proper directory structure maintained\n   - Files logically organized and worthy of GitHub commit\n\n4. **Validation Checks**: Run all quality gates:\n   - Execute `timeout 180s npm run build` - must pass completely\n   - Verify `timeout 120s npm run test:coverage` meets targets\n   - Check `npm run typecheck` shows zero errors\n   - Confirm `npm run lint` passes\n   - Validate `npm run format:check` passes\n\n5. **Fix Failures**: If build fails, analyze the errors and fix them systematically:\n   - TypeScript errors: Fix type issues in source files\n   - Lint errors: Fix code quality issues\n   - Test failures: Fix failing tests or update them if behavior changed\n   - Test Coverage: Improve the test coverage by adding tests for parts that lack coverage.\n   - Security vulnerabilities: Update dependencies or apply patches\n   - Repeat build until it passes completely\n\n6. **User-Level Product Validation**: Test from user perspective:\n   - Build the project locally with `npm run build`\n   - Verify MCP server configured in `.kiro/settings/mcp.json`\n   - Test MCP server tools from Kiro IDE workspace\n   - Validate product functionality as end user would experience it\n   - Check server logs for errors or warnings\n\nReport any issues found with specific file paths, line numbers, and actionable fixes. If workspace is not publication-ready, create MCP tasks to address gaps."
  }
}